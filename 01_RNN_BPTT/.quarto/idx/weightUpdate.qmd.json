{"title":"Updating parameters and RNN training","markdown":{"headingText":"Updating parameters and RNN training","containsRefs":false,"markdown":"\nIn the last section, we have derived the loss gradients for all model parameters.\nIt can be noted that the loss gradients have an extra dimension than its corresponding\nmodel parameters.\n\nFor example, \\\nthe dimension of $\\der{L_t}{\\bm{U}}$ is $\\left(N^{(2)}\\times\nN^{(1)}\\times n\\right)$ whereas the dimension of $\\bm{U}$ is\n$\\left(N^{(1)}\\times n\\right)$.\n\nThis leading dimension $N^{(2)}$ indicates the number of components in the\nfinal output vector. Thus, **every parameter has a loss gradient derived from\nevery output vector component.** So, the loss gradients will be summed on the\nfirst axis (loss axis) to accumulate the update from all loss components and\nthen used to update the parameters.\n\nHence, the update from each loss component will be accumulated by adding the\nloss gradients on the first axis and then used to update the parameters.\n\n## Updating parameters\nThe parameters update equations are given below. The summation is performed on\nthe loss axis direction.\n\n$$\n\\begin{aligned}\n\\bm{c}_i :&= \\left. \\bm{c}_i - \\alpha \\sum_{t=1}^{N^{(2)}} \\sum_{k=1}^{N^{(2)}} \\der{L_t}{\\bm{c}}\\right|_{k,i}, \\ \\ i=1,2,\\dots,N^{(2)} \\\\\n\\bm{V}_{i,j} :&= \\left. \\bm{V}_{i,j} - \\alpha \\sum_{t=1}^{N^{(2)}}\\sum_{k=1}^{N^{(2)}} \\der{L_t}{\\bm{V}}\\right|_{k,i,j}, \\ \\ i=1,2,\\dots,N^{(2)}, \\ \\ j=1,2,\\dots,N^{(1)} \\\\\n\\bm{b}_i :&= \\left. \\bm{b}_i - \\alpha \\sum_{t=1}^{N^{(2)}}\\sum_{k=1}^{N^{(2)}} \\der{L_t}{\\bm{b}}\\right|_{k,i}, \\ \\ i=1,2,\\dots,N^{(1)} \\\\\n\\bm{W}_{i,j} :&= \\left. \\bm{W}_{i,j} - \\alpha \\sum_{t=1}^{N^{(2)}}\\sum_{k=1}^{N^{(2)}} \\der{L_t}{\\bm{W}}\\right|_{k,i,j}, \\ \\ i=1,2,\\dots,N^{(1)}, \\ \\ j=1,2,\\dots,N^{(1)} \\\\\n\\bm{U}_{i,j} :&= \\left. \\bm{U}_{i,j} - \\alpha \\sum_{t=1}^{N^{(2)}}\\sum_{k=1}^{N^{(2)}} \\der{L_t}{\\bm{U}}\\right|_{k,i,j}, \\ \\ i=1,2,\\dots,N^{(1)}, \\ \\ j=1,2,\\dots,n \\\\\n\\end{aligned}\n$$\n\nHere, $\\alpha$ is the learning rate.\n\n:::{.callout-note}\nThe above equations are updating parameters based on one sub-part of data only!\nHence, the algorithms like Batch Gradient Descent and their variants (refer\n[here](https://medium.com/data-science/batch-mini-batch-stochastic-gradient-descent-7a62ecba642a){target=\"blank\"})\nwill involve additional summation over the batch of data being used to update\nthe parameters in the above equations.\n:::\n\n## Training RNNs\n\nWe now have the loss gradients equations in hand. In this section we will\nsee on how to use all these derived equations to Train an RNN.\n\nFirst, the data will be loaded and then encoding will be performed. Here,\nencoding will be needed as the input data will be a word (a sequence of characters).\nEncoding may be skipped for numerical data sequence.\n\nThe size of input and output vectors will be determined during the encoding step.\nThus, the number of hidden neurons will be have to be chosen along with\nlearning rate.\n\nWe have to have a set of hidden vector and its derivatives at $t=0$ for the\nalgorithm to work. Hence we have initialized the hidden vector and tensor\nvariables with zeros. Then we have to initialize the network parameters with\nappropriate techniques such as [Xavier\nInitialization](https://www.geeksforgeeks.org/xavier-initialization/){target=\"blank\"}.\n\nThen, the training loop starts. We will perform forward propagation to get the\ninitial prediction of output vector $\\hat{\\bm{y}}$ which is then used to\ncompute loss value. Then, the $\\hat{\\bm{y}}$ will be taken to back-propagation\nthrough time along with other network parameters for loss gradients\ncomputation. Finally, the network parameters will be updated with the computed\nloss gradients.\n\nThe training loop will be continued until the model converges. The usual\nconvergence criteria will be to set a threshold on loss value and the model is\ntaken as converged/trained when loss goes below threshold.\n\nThe algorithm for RNN training is given below (click on the image for enlarged view).\n\n![](supportingFiles/algorithms/RNNtraining.png){.lightbox}\n\nEach main step in the above algorithm is defined as a function. The forward\npropagation function is given below.\n\n![](supportingFiles/algorithms/ForwardPropagation.png){.lightbox}\n\nHere, the decoding step in the end of forward propagation is optional and\nwill be used only during model inference. Hence, that step can be skipped.\n\nThen the control in algorithm then goes to back-propagation through time function\nwhich is defined below.\n\n![](supportingFiles/algorithms/BPTT.png){.lightbox}\n\nHere, the loss parameter gradient equations are given in the order of\nexecution so that the dependency of variables is satisfied.\n\nOnce back-propagation is done and the gradients are available, the control\nthen moves to the parameter update function that is defined below.\n\n![](supportingFiles/algorithms/ParameterUpdate.png){.lightbox}\n\nAnd then, the loop continues until the convergence criteria is met. This\nconcludes the RNN training algorithm.\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","include-in-header":{"file":"macros_html.qmd"},"output-file":"weightUpdate.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.31","theme":{"light":["comso","_extensions/catppuccin_latte.scss"],"dark":["comso","_extensions/catppuccin_mocha.scss"]}},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"pdflatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","include-in-header":{"file":"macros.qmd"},"output-file":"weightUpdate.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}